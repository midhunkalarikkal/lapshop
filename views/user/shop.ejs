<!-- User navbar -->
<%-include("../userpartials/Navbar.ejs")%>

    <head>
        <!-- Custom css -->
        <link rel="stylesheet" href="/static/css/shop.css">
        <style>


        </style>
    </head>

    <section class="view">
        <!-- Filter navbar for small screen start -->
        <div class="filter-container d-md-none d-block">
            <div class="filter-header">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Filters and sorters</a>
                        <ul class="dropdown-menu">
                            <% if(category && category.length>0 ){ %>
                                <li><a class="dropdown-item" href="#">Filter by category <i
                                            class="fa-solid fa-angles-down"></i> </a>
                                    <ul class="submenu dropdown-menu">
                                        <% for(let i=0; i < category.length; i++){ %>
                                            <li>
                                                <a class="dropdown-item" href="#">
                                                    <input type="checkbox" class="custom-control-input"
                                                        id="<%= category[i]._id %>"
                                                        data-category-id="<%= category[i]._id %>"
                                                        onchange="handleCheckboxChange(this)" <% if
                                                        (categoryId.includes(category[i]._id)) { %> checked <% } %>>
                                                        <label class="custom-control-label" for="allCategory">
                                                            <%= category[i].name %>
                                                        </label>
                                                </a>
                                            </li>
                                        <% } %>
                                    </ul>
                                </li>
                            <% } %>
                            <% if(brand && brand.length>0 ){ %>
                                <li><a class="dropdown-item" href="#"> Filter by brand <i class="fa-solid fa-angles-down"></i> </a>
                                    <ul class="submenu dropdown-menu">
                                        <% for(let i=0; i < brand.length; i++){ %>
                                            <li>
                                                <a class="dropdown-item" href="#">
                                                    <input type="checkbox" class="custom-control-input" id="<%= brand[i]._id %>" data-brand-id="<%= brand[i]._id %>" onchange="handleCheckboxChange(this)" <% if(brandId.includes(brand[i]._id)) { %> checked <% } %>>
                                                    <label class="custom-control-label" for="allCategory">
                                                        <%= brand[i].name %>
                                                    </label>          
                                                </a>
                                            </li>
                                        <% } %>
                                    </ul>
                                </li>
                            <% } %>
                            <li><a class="dropdown-item" href="#"> Sort by price <i class="fa-solid fa-angles-down"></i></a>
                                <ul class="submenu dropdown-menu">
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <input type="radio" class="custom-control-input" id="price-HighToLow">
                                            <label class="custom-control-label" for="price-HighToLow">High - Low</label>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <input type="radio" class="custom-control-input" id="price-LowToHigh">    
                                            <label class="custom-control-label" for="price-LowToHigh">Low - High</label>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <input type="radio" class="custom-control-input" id="A-Z">    
                                            <label class="custom-control-label" for="A-Z">A - Z</label>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <input type="radio" class="custom-control-input" id="Z-A">    
                                            <label class="custom-control-label" for="Z-A">Z - A</label>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <!--  Filter navbar for small screen end -->



        <!-- Advertisement carousel start -->
        <div id="carouselExampleAutoplaying" class="carousel slide mt-md-4 mt-0" data-bs-ride="carousel">
            <div class="carousel-inner">
                <% if(adCarousel !="" ){ %>
                    <% adCarousel.forEach((adc, index)=> { %>
                        <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                            <img src="/static/images/AdCarousels/<%= adc.image %>" class="d-block w-100" alt="...">
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="carousel-item">
                        <img src="/static/images/AdCarousels/Ad banner 7.jpg" class="d-block w-100" alt="...">
                    </div>
                <% } %>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying"
                data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying"
                data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
        <!-- Advertisement carousel end -->

        <!-- Shop Start -->
        <div class="container-fluid pt-5">
            <div class="row px-xl-5">
                <!-- Shop Sidebar Start -->
                <div class="col-md-2 d-none d-md-block">
                    <h5 class="font-weight-semi-bold mb-4">Apply filters</h5>
                    <!-- Category Start -->
                    <% if(category && category.length>0 ){ %>
                        <div class="border-bottom mb-4 pb-4">
                            <h6 class="font-weight-semi-bold mb-4">Filter by Category</h6>
                            <% for(let i=0; i < category.length; i++){ %>
                                <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                                    <input type="checkbox" class="custom-control-input" id="<%= category[i]._id %>" data-category-id="<%= category[i]._id %>" onchange="handleCheckboxChange(this)" <% if (categoryId.includes(category[i]._id)) { %> checked <% } %>>
                                    <label class="custom-control-label" for="allCategory"><%= category[i].name %></label>      
                                </div>
                            <% } %>
                        </div>
                    <% } %>
                    <!-- Category End -->

                    <!-- Brand Start -->
                    <% if(brand && brand.length>0 ){ %>
                        <div class="border-bottom mb-4 pb-4">
                            <h6 class="font-weight-semi-bold mb-4">Filter by Brand</h6>
                            <form>
                                <% for(let i=0; i < brand.length; i++){ %>
                                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                                        <input type="checkbox" class="custom-control-input" id="<%= brand[i]._id %>" data-brand-id="<%= brand[i]._id %>" onchange="handleCheckboxChange(this)" <% if(brandId.includes(brand[i]._id)) { %> checked <% } %>>
                                        <label class="custom-control-label" for="allCategory"> <%= brand[i].name %></label>
                                    </div>
                                <% } %>
                            </form>
                        </div>
                    <% } %>
                    <!-- Brand End -->

                    <!-- Sorting Start -->
                    <div class="border-bottom mb-4 pb-4">
                        <h6 class="font-weight-semi-bold mb-4">Sort products</h6>
                        <form>
                            <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                                <input type="radio" class="custom-control-input" id="price-HighToLow">
                                <label class="custom-control-label" for="price-HighToLow">High - Low</label>
                            </div>
                            <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                                <input type="radio" class="custom-control-input" id="price-LowToHigh">
                                <label class="custom-control-label" for="price-LowToHigh">Low - High</label>
                            </div>
                            <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                                <input type="radio" class="custom-control-input" id="A-Z">
                                <label class="custom-control-label" for="A-Z">A - Z</label>
                            </div>
                            <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                                <input type="radio" class="custom-control-input" id="Z-A">
                                <label class="custom-control-label" for="Z-A">Z - A</label>
                            </div>
                        </form>
                    </div>
                    <!-- Sorting End -->
                </div>
                <!-- Shop Sidebar End -->

                <% const productsPerPage=6; %>
                    <div class="col-md-10">
                        <div class="container">
                            <!-- Shop Product Start -->
                            <div class="row pb-3" id="productCardRow">
                                <% const currentPageProducts=productData.slice((currentPage - 1) * productsPerPage,
                                    currentPage * productsPerPage); %>
                                    <% currentPageProducts.forEach((product,index)=>{ %>
                                        <div class="col-lg-4 col-md-6 col-sm-6 pb-1">
                                            <div class="card product-item mb-4 product-card shadow">
                                                <a href="/productDetail/<%= product._id %>" class="product-outline">
                                                    <div
                                                        class="card-header product-img position-relative overflow-hidden  p-0">
                                                        <img class="img-fluid product-image w-100"
                                                            src=" /static/images/ProductImages/<%= product.images[0] %>"
                                                            alt="">
                                                        <% if (wishlistProdId !="" ) { %>
                                                            <% for(let i=0; i < wishlistProdId.length; i++){ %>
                                                                <% if(wishlistProdId[i]==product._id.toString()){ %>
                                                                    <a href="#" class="position-absolute"
                                                                        style="top: 8px; right: 50px; z-index: 1;"
                                                                        data-product-id="<%= product._id %>"
                                                                        onclick="addToWishlist(this)">
                                                                        <i class="fa-solid fa-heart wish-btn"></i>
                                                                    </a>
                                                                    <% } %>
                                                                        <% } %>
                                                                            <% } %>
                                                                                <a href="#" class="position-absolute"
                                                                                    style="top: 8px; right: 50px; z-index: 1;"
                                                                                    data-product-id="<%= product._id %>"
                                                                                    onclick="addToWishlist(this)">
                                                                                    <i
                                                                                        class="fa-regular fa-heart wish-btn"></i>
                                                                                </a>

                                                                                <div class="position-absolute"
                                                                                    style="top: 5px; right: 5px; z-index: 1;">
                                                                                    <span class="badge">New</span>
                                                                                </div>
                                                    </div>
                                                    <div class="card-body">
                                                        <h6 class="text-truncate product-name tet-center mb-3">
                                                            <%= product.name %>
                                                        </h6>
                                                        <div class="d-flex align-items-end">
                                                            <p>
                                                                <span class="discount-percentage">-<%=
                                                                        product.discountPercentage %>%</span>
                                                                <span class="offer-price mx-2">₹<%= product.offerPrice
                                                                        %></span>
                                                                <span class="real-price small mx-2">₹<del
                                                                        class="real-price">
                                                                        <%= product.realPrice %>
                                                                    </del></span>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </a>
                                                <% if (cartProdId !="" ) { %>
                                                    <% for(let i=0; i < cartProdId.length; i++){ %>
                                                        <% if(cartProdId[i]==product._id.toString()){ %>
                                                            <button class="card-footer d-flex justify-content-center">
                                                                <a href="/cart" class="btn btn-sm p-0">
                                                                    <i class="fas fa-shopping-cart"></i> Go to cart
                                                                </a>
                                                            </button>
                                                            <% break; %>
                                                                <% } %>
                                                                    <!-- If it's the last iteration and no match is found -->
                                                                    <% if(i===cartProdId.length - 1){ %>
                                                                        <button
                                                                            class="card-footer d-flex justify-content-center"
                                                                            data-prod-id="<%= product._id %>"
                                                                            onclick="addToCart(this)">
                                                                            <a href="" class="btn btn-sm p-0">
                                                                                <i class="fas fa-shopping-cart"></i> Add
                                                                                to cart
                                                                            </a>
                                                                        </button>
                                                                        <% } %>
                                                                            <% } %>
                                                                                <% } else { %>
                                                                                    <!-- Render "Add to cart" button if cartProdId is empty -->
                                                                                    <button
                                                                                        class="card-footer d-flex justify-content-center"
                                                                                        data-prod-id="<%= product._id %>"
                                                                                        onclick="addToCart(this)">
                                                                                        <a href=""
                                                                                            class="btn btn-sm p-0">
                                                                                            <i
                                                                                                class="fas fa-shopping-cart"></i>
                                                                                            Add to cart
                                                                                        </a>
                                                                                    </button>
                                                                                    <% } %>
                                            </div>
                                        </div>
                                        <% } ) %>
                            </div>
                            <!-- Shop Product end -->

                            <!--  Pagination for the shop page start , This will hidden in the filtering and sorting page -->
                            <div class="col-12 pb-1" id="shopPagination">
                                <nav aria-label="Page navigation">
                                    <ul class="pagination justify-content-center mb-3">
                                        <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                                            <a class="page-link" href="/shop?page=<%= currentPage - 1 %>"
                                                aria-label="Previous">
                                                <span aria-hidden="true">&laquo;</span>
                                                <span class="sr-only">Previous</span>
                                            </a>
                                        </li>
                                        <% for(let i=1; i<=totalPages; i++) { %>
                                            <li class="page-item mx-1 <%= currentPage === i ? 'active' : '' %>">
                                                <a class="page-link" href="/shop?page=<%= i %>">
                                                    <%= i %>
                                                </a>
                                            </li>
                                            <% } %>
                                                <li
                                                    class="page-item mx-1 <%= currentPage === totalPages ? 'disabled' : '' %>">
                                                    <a class="page-link" href="/shop?page=<%= currentPage + 1 %>"
                                                        aria-label="Next">
                                                        <span aria-hidden="true">&raquo;</span>
                                                        <span class="sr-only">Next</span>
                                                    </a>
                                                </li>
                                    </ul>
                                </nav>
                            </div>
                            <!--  Pagination for the shop page end -->

                            <!--  Pagination for the filtering and sorting start -->
                            <div class="col-12 pb-1">
                                <nav aria-label="Page navigation">
                                    <ul class="pagination justify-content-center mb-3" id="pagination">

                                    </ul>
                                </nav>
                            </div>
                            <!--  Pagination for the filtering and sorting end -->

                        </div>
                    </div>
                    <!-- Shop Product End -->
            </div>
        </div>
        <!-- Shop End -->
    </section>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <script>
        ////// Function to add id's of the category checkbox \\\\\\
        let selectedCategories = new Set();
        let selectedBrands = new Set();
        let sortCriteria = null;
        let currentPage = 1
        let inputValue = null

        ////// Search products \\\\\\
        $(document).ready(function () {
            var searchInput = $('.search-input');

            searchInput.on('input', function () {
                inputValue = $(this).val();
                console.log('Input value changed:', inputValue);
                updateProductList();
            });
        });

        ////// Function select and deselect the radio button and triggering the fetch \\\\\\
        $(document).ready(function () {
            $('input[type="radio"]').click(function () {
                const selectedSortCriteria = $(this).attr('id');

                if (selectedSortCriteria === "price-HighToLow") {
                    sortCriteria = "highToLow";
                } else if (selectedSortCriteria === "price-LowToHigh") {
                    sortCriteria = "lowToHigh";
                } else if (selectedSortCriteria === "A-Z") {
                    sortCriteria = "ascending";
                }else if (selectedSortCriteria === "Z-A") {
                    sortCriteria = "descending";
                } else {
                    sortCriteria = null;
                }

                // Update radio button selection
                $('input[type="radio"]').prop('checked', false); // Deselect all
                $(this).prop('checked', true);

                updateProductList();
            });
        });

        ////// Function update the product according to the users filter criteria \\\\\\
        function handleCheckboxChange(checkbox) {
            const categoryId = checkbox.getAttribute("data-category-id");
            const brandId = checkbox.getAttribute("data-brand-id");

            if (categoryId) {
                if (checkbox.checked) {
                    selectedCategories.add(categoryId);
                } else {
                    selectedCategories.delete(categoryId);
                }
            } else if (brandId) {
                if (checkbox.checked) {
                    selectedBrands.add(brandId);
                } else {
                    selectedBrands.delete(brandId);
                }
            }

            updateProductList();
        }

        ////// Function to fetch the categorized and brandwise products and show it dynamically \\\\\\
        function updateProductList() {
            console.log("current page :", currentPage)
            document.getElementById("shopPagination").style.display = "none";
            fetch('/shopCategoryId', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ categories: [...selectedCategories], brands: [...selectedBrands], sortCriteria, currentPage, inputValue })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    let productData = data.productData
                    let totalPages = data.totalPages
                    let prodId = data.prodId
                    let cartProdId = data.cartProdId
                    console.log("productData : ", productData)
                    console.log("totalPages : ", totalPages)
                    console.log("prodId : ", prodId)
                    updatePaginationUI(totalPages);

                    ////// Emptying the child elements of the productCardRow div \\\\\\
                    $("#productCardRow").empty()

                    productData.forEach((product) => {
                        const productDiv = $(
                            `<div class='col-lg-4 col-md-6 col-sm-6 pb-1'>
                                <div class='card product-item mb-4 product-card shadow'>
                                    <a href='/productDetail/${product._id}' class='product-outline'>
                                        <div class='card-header product-img position-relative overflow-hidden  p-0'>
                                            <img class='card-header-img img-fluid product-image w-100' src='/static/images/ProductImages/${product.images[0]}' alt=''>

                                            <div class='position-absolute' style='top: 5px; right: 5px; z-index: 1;'>
                                                <span class='badge'>New</span>
                                            </div>
                                        </div>
                                        <div class='card-body'>
                                            <h6 class='text-truncate product-name text-center mb-3'>${product.name}</h6>
                                            <div class='d-flex align-items-end'>
                                                <h6 class='offer-price'>₹${product.offerPrice}</h6>
                                                <h6 class='real-price small mx-3'>₹<del class='real-price'>${product.realPrice}</del></h6>
                                            </div>
                                        </div>
                                    </a>
                                    
                                </div>
                            </div>`
                        );

                        ////// Dynamically adding the wishlist button to the product \\\\\\
                        const productCardHeader = productDiv.find('.card-header.product-img');
                        if (prodId != "") {
                            for (let i = 0; i < prodId.length; i++) {
                                if (prodId[i] == product._id.toString()) {
                                    const wishlistButton = $(`
                                            <a href="#" class="position-absolute" style="top: 8px; right: 50px; z-index: 1;" data-product-id="${product._id}" onclick="addToWishlist(this)">
                                                <i class="fa-solid fa-heart wish-btn"></i> 
                                            </a>
                                        `);
                                    productCardHeader.append(wishlistButton);
                                }
                            }
                        }
                        const defaultWishlistButton = $(`
                                <a href="#" class="position-absolute" style="top: 8px; right: 50px; z-index: 1;" data-product-id="${product._id}" onclick="addToWishlist(this)">
                                    <i class="fa-regular fa-heart wish-btn"></i> 
                                </a>
                            `);
                        productCardHeader.append(defaultWishlistButton);

                        // Dynamically adding the add to cart / go to cart button to the product \\\\\\
                        const productCardFooter = productDiv.find('.card.product-item'); // Change .card-header.product-outline to .card.product-item

                        if (cartProdId != "") {
                            let isInCart = false; // Flag to track if product is in cart
                            for (let i = 0; i < cartProdId.length; i++) {
                                if (cartProdId[i] == product._id.toString()) {
                                    isInCart = true; // Set flag to true if product is found in cart
                                    break; // Exit loop once product is found in cart
                                }
                            }

                            if (isInCart) {
                                // If product is in cart, create the go to cart button
                                const goToCartButton = $(`
                                    <button class="card-footer d-flex justify-content-center">
                                        <a href="/cart" class="btn btn-sm p-0">
                                            <i class="fas fa-shopping-cart"></i> Go to cart
                                        </a>
                                    </button>
                                `);
                                productCardFooter.append(goToCartButton);
                            } else {
                                // If product is not in cart, create the add to cart button
                                const addToCartButton = $(`
                                    <button class="card-footer d-flex justify-content-center"
                                            data-prod-id="${product._id}"
                                            onclick="addToCart(this)">
                                        <a href="#" class="btn btn-sm p-0">
                                            <i class="fas fa-shopping-cart"></i> Add to cart
                                        </a>
                                    </button>
                                `);
                                productCardFooter.append(addToCartButton);
                            }
                        }

                        const defaultAddToCartButton = $(`
                                    <button class="card-footer d-flex justify-content-center"
                                            data-prod-id="${product._id}"
                                            onclick="addToCart(this)">
                                        <a href="#" class="btn btn-sm p-0">
                                            <i class="fas fa-shopping-cart"></i> Add to cart
                                        </a>
                                    </button>
                                `);
                                productCardFooter.append(defaultAddToCartButton);
                       

                        ////// Appending the dynamically created product card in to the productCardRow div \\\\\\
                        $("#productCardRow").append(productDiv)
                    });
                    ////// if the productData's length is 0 in response , then redirecting to shop page \\\\\\
                    if (productData.length == 0) {
                        Swal.fire({
                            title: "No Products Found",
                            text: "No products were found for the selected filters.",
                            icon: "info",
                            timer: 2000,
                            timerProgressBar: true,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.href = '/shop'
                        })
                    }
                })
                .catch(error => {
                    console.error('Error fetching products:', error);
                });
        }

        ////////// Script to the dropdownmenu in the small devices for the filter and sort \\\\\\
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll('.dropdown-menu').forEach(function (element) {
                element.addEventListener('click', function (e) {
                    e.stopPropagation();
                });
            })

            if (window.innerWidth < 992) {
                document.querySelectorAll('filter-container .dropdown').forEach(function (everydropdown) {
                    everydropdown.addEventListener('hidden.bs.dropdown', function () {
                        this.querySelectorAll('.submenu').forEach(function (everysubmenu) {
                            everysubmenu.style.display = 'none';
                        });
                    })
                });

                document.querySelectorAll('.dropdown-menu a').forEach(function (element) {
                    element.addEventListener('click', function (e) {

                        let nextEl = this.nextElementSibling;
                        if (nextEl && nextEl.classList.contains('submenu')) {
                            e.preventDefault();
                            console.log(nextEl);
                            if (nextEl.style.display == 'block') {
                                nextEl.style.display = 'none';
                            } else {
                                nextEl.style.display = 'block';
                            }

                        }
                    });
                })
            }
        });

        ////// Function to update pagination UI \\\\\\
        function updatePaginationUI(totalPages) {
            console.log("Totalpages :", totalPages)
            console.log("currenntpage :", currentPage)
            // hinding the shop page main pagination
            const paginationElement = document.querySelector('#pagination');
            // Clearin the second pagination child elements of ui
            paginationElement.innerHTML = '';

            // Create preious link for the second pagination
            let paginationHTML = `
        <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="changePage(${currentPage - 1})" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
                <span class="sr-only">Previous</span>
            </a>
        </li>
    `;

            // Create page numbers for the second pagination
            for (let i = 1; i <= totalPages; i++) {
                paginationHTML += `
            <li class="page-item mx-1 ${currentPage === i ? 'active' : ''}">
                <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
            </li>
        `;
            }

            // Creating hte next button for the second pagination
            paginationHTML += `
        <li class="page-item mx-1 ${currentPage === totalPages ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="changePage(${currentPage + 1})" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
                <span class="sr-only">Next</span>
            </a>
        </li>
    `;

            paginationElement.innerHTML = paginationHTML;
        }

        ////// Function to change current page and update product list \\\\\\
        function changePage(pageNumber) {
            currentPage = pageNumber;
            updateProductList();
        }

        // Function to add product to wishlist
        function addToWishlist(element) {
            var productId = element.getAttribute('data-product-id');

            var data = {
                productId: productId
            };

            console.log("Data :", data)

            fetch('/addToWishlist', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    const contentType = response.headers.get('content-type');
                    const message = "Your account is blocked, Please contact us"
                    const type = "danger"
                    if (contentType && contentType.includes('application/json')) {
                        return response.json(); 
                    } else {
                        window.location.href = `/login?message=${encodeURIComponent(message)}&type=${type}`;    
                    }
                })
                .then(data => {
                    console.log("data :", data)
                    var wishlistButton = document.querySelector(`[data-product-id="${productId}"] .fa-heart`);
                    if (data.added) {
                        wishlistButton.classList.add('fa-solid');
                        wishlistButton.classList.remove('fa-regular');
                    } else {
                        wishlistButton.classList.remove('fa-solid');
                        wishlistButton.classList.add('fa-regular');
                    }
                    Swal.fire({
                        title: "Wishlist",
                        html: `<i class="fa-solid fa-heart" style="color: #f01919;"></i> ${data.message}`,
                        icon: "success",
                        timer: 2000,
                        timerProgressBar: true,
                        showConfirmButton: false
                    })
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        }

        ////// Funciton to add a product to cart \\\\\\
        function addToCart(element) {
            const productId = element.getAttribute('data-prod-id');
            console.log('Product ID:', productId);

            fetch('/addProductToCartFromShop', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productId: productId })
            })
                .then(response => {
                    const contentType = response.headers.get('content-type');
                    // const message = "Your account is blocked, Please contact us"
                    // const type = "danger"
                    if (contentType && contentType.includes('application/json')) {
                        return response.json(); 
                    } else {
                        window.location.href = `/login`;
                        // ?message=${encodeURIComponent(message)}&type=${type}
                    }
                })
                .then(data => {
                    console.log(data)
                    Swal.fire({
                        title: "Success",
                        text: data.message,
                        icon: "success",
                        timer: 2000,
                        timerProgressBar: true,
                        showConfirmButton: false
                    }).then(() => {
                        location.reload();
                    });
                })
                .catch(error => {
                    console.log("error :", error)
                    Swal.fire({
                        title: "Error",
                        text: error.message,
                        icon: "error",
                        timer: 2000,
                        timerProgressBar: true,
                        showConfirmButton: false
                    });
                });
        }


    </script>

    <!-- User footer -->
    <%-include("../userpartials/footer.ejs")%>